name: Quotes Every 2 hour

on:
  schedule:
    - cron: '0 */2 * * *'  # Every 2 hours
  workflow_dispatch:  

jobs:
  update-quote:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Install dependencies
        run: sudo apt-get install -y jq  

      - name: Make random commits
        run: |
          # Generate random number of commits (0 to 40)
          NUM_COMMITS=$(( RANDOM % 11 ))
          echo "Number of commits to make: $NUM_COMMITS"

          for ((i=1; i<=NUM_COMMITS; i++)); do
            # Fetch a random quote
            QUOTE=$(curl -s https://zenquotes.io/api/random | jq -r '.[0].q')

            # Fallback if empty or null
            if [[ -z "$QUOTE" || "$QUOTE" == "null" ]]; then
              QUOTE="Keep pushing forward, success is near! ðŸš€"
            fi

            # Update README.md quote section
            sed -i '/<!-- QUOTE_START -->/,/<!-- QUOTE_END -->/c\
            <!-- QUOTE_START -->\n\n<img src="https://img.shields.io/badge/ðŸ“œ%20Quote%20of%20the%20Moment!-53A2FE" style="height: 35px;"/>\n\n> '"$QUOTE"'\n\n<!-- QUOTE_END -->' README.md

            git add README.md

            # Commit changes if any
            if git diff --cached --quiet; then
              echo "No changes detected for commit $i, skipping..."
            else
              GIT_COMMITTER_NAME="Ajayrx" GIT_COMMITTER_EMAIL="137894866+Ajayrx@users.noreply.github.com" \
              git commit -m "Updated quote of the moment ($i/$NUM_COMMITS)" --author="Ajayrx <137894866+Ajayrx@users.noreply.github.com>"
              echo "Committed update $i of $NUM_COMMITS"
            fi

            # Optional delay between commits
            sleep 10
          done

          # Push all commits after loop
          git push --force

      - name: Final status
        run: echo "Completed $NUM_COMMITS commit(s) of quote updates."
